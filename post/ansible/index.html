<!DOCTYPE html>
<html>

    <head>
        <title> Ansible Basico &middot; jCastro </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.88.1" />




<script src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">


<link rel="stylesheet" href="http://jcastro.net/css/nix.css">



<link rel="shortcut icon" href="/favicon.ico">



<link href="https://fonts.googleapis.com/css?family=Inconsolata%7COpen+Sans%7CConcert+One" rel="stylesheet">






    </head>

    <body>
        <header>
<nav class="navbar navbar-default navbar-fixed-top navbar-inverse font-header">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
      <a class="navbar-brand" id="green-terminal" href='http://jcastro.net/'>
        jcastro@jcastro.net ~ $
      </a>
		</div>

		
		<div class="collapse navbar-collapse" id="navbar-collapse-1">
			<ul class="nav navbar-nav navbar-right">
				<li>
					<a href='http://jcastro.net/'>/home/jcastro</a>
        </li>
        
				
				
				<li class="dropdown">
                    
            		<a href="http://jcastro.net/about">~/about</a>
            		
        		</li>
        		
				
				<li class="dropdown">
                    
            		<a href="http://jcastro.net/post">~/post</a>
            		
        		</li>
        		

			</ul>
		</div>
	</div>
</nav>
</header>

        <div class="flex-wrapper">
            <div class="container wrapper">
                <h1><a href="http://jcastro.net/post/ansible/">Ansible Basico</a></h1>
                <span class="post-date">2021-09-14 </span>
                <div class="post-content">
                    <h1 id="basico-sobre-ansible">Basico sobre Ansible</h1>
<hr>
<p><strong>NOTAS:</strong> sobre <code>ansible</code></p>
<h2 id="arquivo-de-configuraçao">Arquivo de configuraçao</h2>
<pre><code>/etc/ansible/ansible.cfg
vai usar o arquivo caso existe no diretorio padrão
ou no diretorio home 
</code></pre>
<h2 id="lab-access">lab access</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Login is ssh student1@3.127.116.127 
Password is RUZszeRcMvYcVS
</code></pre></div><h2 id="facts">Facts:</h2>
<pre><code>coleta informações sobre o host alvo, sempre é executado antes de qualquer
 outro modulo ou comando
para desativar add no playbook
gather_facts: false
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ansible localhost -m setup
localhost | success &gt;&gt; <span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;ansible_facts&#34;</span>: <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;ansible_default_ipv4&#34;</span>: <span style="color:#f92672">{</span>
          <span style="color:#e6db74">&#34;address&#34;</span>: <span style="color:#e6db74">&#34;192.168.1.37&#34;</span>,
          <span style="color:#e6db74">&#34;alias&#34;</span>: <span style="color:#e6db74">&#34;wlan0&#34;</span>,
          <span style="color:#e6db74">&#34;gateway&#34;</span>: <span style="color:#e6db74">&#34;192.168.1.1&#34;</span>,
          <span style="color:#e6db74">&#34;interface&#34;</span>: <span style="color:#e6db74">&#34;wlan0&#34;</span>,
          <span style="color:#e6db74">&#34;macaddress&#34;</span>: <span style="color:#e6db74">&#34;c4:85:08:3b:a9:16&#34;</span>,
          <span style="color:#e6db74">&#34;mtu&#34;</span>: 1500,
          <span style="color:#e6db74">&#34;netmask&#34;</span>: <span style="color:#e6db74">&#34;255.255.255.0&#34;</span>,
          <span style="color:#e6db74">&#34;network&#34;</span>: <span style="color:#e6db74">&#34;192.168.1.0&#34;</span>,
          <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;ether&#34;</span>
      <span style="color:#f92672">}</span>,
</code></pre></div><h2 id="plays">Plays:</h2>
<pre><code> conjunto de tarefas que são excutadas e hosts remotos 
</code></pre>
<h2 id="playbooks">Playbooks:</h2>
<pre><code> Arquivo que contem uma ou mais tasks
</code></pre>
<h2 id="comandos">Comandos</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    $ ansible --version
    $ ansible all --list-hosts


    <span style="color:#75715e">#checkar sintaxe do yml file</span>
    $ ansible-playbook --syntax-check install_apache.yml

    <span style="color:#75715e">#rodando playbook</span>
    $ ansible-playbook install_apache.yml




    <span style="color:#75715e"># check all my inventory hosts are ready to be</span>
    <span style="color:#75715e"># managed by Ansible</span>
    $ ansible all -m ping
    <span style="color:#75715e"># The ping module differs from a traditional networking ping and </span>
    <span style="color:#75715e">#tests whether Ansible can make an ssh connection to the target </span>
    <span style="color:#75715e">#hosts. It is common to use this to test connectivity and as an     #early step in debugging connection issues.</span>



    <span style="color:#75715e"># collect and display the discovered facts</span>
    <span style="color:#75715e"># for the localhost</span>
    $ ansible localhost -m setup

    <span style="color:#75715e"># run the uptime command on all hosts in the</span>
    <span style="color:#75715e"># web group</span>
    $ ansible web -m command -a <span style="color:#e6db74">&#34;uptime&#34;</span> -o
    <span style="color:#75715e"># a opção -o retorna o comando em uma unica linha por host</span>
    $ ansible web -m service -a <span style="color:#e6db74">&#34;name=httpd state=stopped&#34;</span> -b

    $ ansible all -m command -a <span style="color:#e6db74">&#34;cat /etc/os-release&#34;</span>
</code></pre></div><h2 id="variaveis">Variaveis:</h2>
<pre><code>Usada em playbooks para mapear valores para serem usados mais de uma 
vez dentro do codigo 
</code></pre>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">---
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Apache playbook</span>
    <span style="color:#f92672">hosts</span>: <span style="color:#ae81ff">web</span>
    <span style="color:#f92672">become</span>: <span style="color:#66d9ef">yes</span>
    <span style="color:#f92672">gather_facts</span>: <span style="color:#66d9ef">false</span>
    <span style="color:#f92672">vars</span>:
    <span style="color:#75715e">#variavel 1 com uma lista e 2 valores httpd e mod_wsgi</span>
      <span style="color:#f92672">httpd_packages</span>:
        - <span style="color:#ae81ff">httpd</span>
        - <span style="color:#ae81ff">mod_wsgi</span>
    <span style="color:#75715e">#variavel 2 com a msg &#34;This is a test message&#34;</span>
      <span style="color:#f92672">apache_test_message</span>: <span style="color:#ae81ff">This is a test message</span>
      <span style="color:#f92672">tasks</span>:
       - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">install httpd packages</span>
         <span style="color:#f92672">yum</span>:
        <span style="color:#75715e"># pegando a variavel httpd_packages e passando no </span>
        <span style="color:#75715e">#loop dentro de item </span>
          <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;{{ item }}&#34;</span>
          <span style="color:#f92672">state</span>: <span style="color:#ae81ff">present</span>
         <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ httpd_packages }}&#34;</span>
         <span style="color:#f92672">notify</span>: <span style="color:#ae81ff">restart apache service</span>
</code></pre></div><h2 id="templates">Templates:</h2>
<pre><code>Ansible tem a feature de JINJA2 template que permite dinamicamente:
    - setar ou modificar play vars
    - aplicar logica condicional
    - gerar arquivos de configuração baseados em vars
</code></pre>
<h2 id="roles">Roles:</h2>
<pre><code>permite manter e compartilhar de forma mais facil os playbooks
organizando eles em diretorios
</code></pre>
<p><em><strong>Exemplo de roles:</strong></em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">site.yml
roles/
   common/
     files/
     templates/
     tasks/
     handlers/
     vars/
     defaults/
     meta/
   apache/
     files/
     templates/
     tasks/
     handlers/
     vars/
     defaults/
</code></pre></div><h2 id="ansible-galaxy">Ansible galaxy</h2>
<pre><code> site de compartilhamento de ansible roles 
</code></pre>
<h2 id="exemplo-de-playbook">Exemplo de playbook</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">---
- name: install and start apache
  hosts: web
  become: yes
  vars:
    webserver: httpd

  tasks:
  - name: <span style="color:#e6db74">&#34;{{ webserver }} package is present&#34;</span>
    yum:
      name: <span style="color:#e6db74">&#34;{{ webserver }}&#34;</span>
      state: latest
    notify: restart webserver

  - name: latest index.html file is present
    copy:
      src: files/index.html
      dest: /var/www/html/
handlers:
- name: restart webserver
  service:
    name: <span style="color:#e6db74">&#34;{{ webserver}}&#34;</span>
    state: restarted 




</code></pre></div>
                </div>
                
                <div class="post-comments">
                    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "your_disqus_shortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
                
            </div>
            <footer class="footer text-center">
<p>Copyright &copy; 2021 Joao Castro -
<span class="credit">
	Powered by
	<a target="_blank" href="https://gohugo.io">Hugo</a>
	and
	<a target="_blank" href="https://github.com/LordMathis/hugo-theme-nix/">Nix</a> theme.
</span>
</p>
</footer>

        </div>
    </body>
